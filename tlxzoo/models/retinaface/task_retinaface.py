import tlxzoo.models.retinaface
from ...task.task import BaseForFaceRecognition
from .retinaface import *
from ...utils.output import BaseTaskOutput


class RetinaFaceForFaceRecognition(BaseForFaceRecognition):
    def __init__(self, config, *inputs, **kwargs):
        super().__init__(config, *inputs, **kwargs)

        self.model = RetinaFaceModel(config.model_config, name="RetinaFaceModel")

        self.multi_box_loss = MultiBoxLoss()

    def forward(self, inputs):
        return self.model(inputs)

    def loss_fn(self, predictions, labels):
        losses = {}
        losses['loc'], losses['landm'], losses['class'] = self.multi_box_loss(labels, predictions)
        total_loss = tlx.add_n([l for l in losses.values()])
        return total_loss


def load_ckpt_weight(model, file_path):
    import tensorflow as tf
    # init_vars = tf.train.list_variables(file_path)
    # for name, shape in init_vars:
    #     print(name, shape)
    weight_name_dict = {'conv1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-0/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-0/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-1/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-1/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-1/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-1/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-2/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-2/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-3/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-3/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-3/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-3/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-4/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-4/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-5/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-5/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-5/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-5/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-6/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-6/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-7/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-7/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-8/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-8/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-8/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_0_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-8/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-9/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-8/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-9/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block1_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-9/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-10/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-10/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-11/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-11/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-11/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-11/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-12/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-12/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-13/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-13/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-13/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-13/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-14/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-14/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-15/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-15/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-15/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block2_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-15/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-16/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-16/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-17/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-17/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-17/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-17/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-18/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-18/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-19/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-19/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-19/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-19/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-20/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-20/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-21/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-21/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-21/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv2_block3_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-21/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-22/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-22/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-23/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-23/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-23/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-23/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-24/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-24/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-25/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-25/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-25/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-25/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-26/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-26/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-27/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-27/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-28/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-28/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-28/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_0_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-28/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-29/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-28/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-29/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block1_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-29/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-30/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-30/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-31/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-31/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-31/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-31/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-32/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-32/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-33/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-33/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-33/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-33/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-34/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-34/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-35/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-35/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-35/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block2_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-35/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-36/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-36/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-37/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-37/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-37/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-37/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-38/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-38/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-39/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-39/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-39/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-39/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-40/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-40/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-41/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-41/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-41/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block3_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-41/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-42/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-42/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-43/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-43/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-43/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-43/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-44/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-44/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-45/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-45/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-45/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-45/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-46/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-46/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-47/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-47/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-47/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv3_block4_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-47/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-48/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-48/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-49/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-49/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-49/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-49/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-50/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-50/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-51/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-51/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-51/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-51/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-52/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-52/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-53/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-53/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-54/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-54/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-54/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_0_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-54/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-55/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-54/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-55/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block1_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-55/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-56/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-56/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-57/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-57/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-57/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-57/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-58/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-58/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-59/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-59/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-59/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-59/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-60/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-60/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-61/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-61/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-61/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block2_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-61/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-62/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-62/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-63/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-63/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-63/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-63/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-64/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-64/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-65/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-65/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-65/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-65/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-66/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-66/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-67/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-67/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-67/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block3_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-67/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-68/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-68/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-69/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-69/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-69/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-69/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-70/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-70/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-71/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-71/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-71/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-71/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-72/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-72/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-73/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-73/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-73/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block4_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-73/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-74/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-74/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-75/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-75/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-75/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-75/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-76/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-76/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-77/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-77/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-77/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-77/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-78/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-78/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-79/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-79/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-79/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block5_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-79/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-80/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-80/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-81/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-81/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-81/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-81/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-82/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-82/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-83/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-83/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-83/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-83/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-84/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-84/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-85/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-85/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-85/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv4_block6_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-85/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-86/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-86/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-87/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-87/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-87/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-87/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-88/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-88/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-89/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-89/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-89/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-89/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-90/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-90/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-91/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-91/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-92/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-92/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-92/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_0_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-92/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-93/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-92/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-93/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block1_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-93/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-94/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-94/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-95/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-95/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-95/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-95/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-96/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-96/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-97/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-97/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-97/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-97/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-98/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-98/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-99/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-99/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-99/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block2_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-99/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-100/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-100/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-101/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-101/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-101/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_1_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-101/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-102/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-102/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-103/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-103/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-103/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_2_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-103/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_conv/kernel:0': 'model/layer_with_weights-0/layer_with_weights-104/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_conv/bias:0': 'model/layer_with_weights-0/layer_with_weights-104/bias/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_bn/gamma:0': 'model/layer_with_weights-0/layer_with_weights-105/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_bn/beta:0': 'model/layer_with_weights-0/layer_with_weights-105/beta/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_bn/moving_mean:0': 'model/layer_with_weights-0/layer_with_weights-105/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'conv5_block3_3_bn/moving_variance:0': 'model/layer_with_weights-0/layer_with_weights-105/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output1/conv/kernel:0': 'model/layer_with_weights-1/output1/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output1/bn/gamma:0': 'model/layer_with_weights-1/output1/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output1/bn/beta:0': 'model/layer_with_weights-1/output1/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output2/conv/kernel:0': 'model/layer_with_weights-1/output2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output2/bn/gamma:0': 'model/layer_with_weights-1/output2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output2/bn/beta:0': 'model/layer_with_weights-1/output2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output3/conv/kernel:0': 'model/layer_with_weights-1/output3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output3/bn/gamma:0': 'model/layer_with_weights-1/output3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output3/bn/beta:0': 'model/layer_with_weights-1/output3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge1/conv/kernel:0': 'model/layer_with_weights-1/merge1/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge1/bn/gamma:0': 'model/layer_with_weights-1/merge1/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge1/bn/beta:0': 'model/layer_with_weights-1/merge1/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge2/conv/kernel:0': 'model/layer_with_weights-1/merge2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge2/bn/gamma:0': 'model/layer_with_weights-1/merge2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge2/bn/beta:0': 'model/layer_with_weights-1/merge2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output1/bn/moving_mean:0': 'model/layer_with_weights-1/output1/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output1/bn/moving_variance:0': 'model/layer_with_weights-1/output1/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output2/bn/moving_mean:0': 'model/layer_with_weights-1/output2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output2/bn/moving_variance:0': 'model/layer_with_weights-1/output2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output3/bn/moving_mean:0': 'model/layer_with_weights-1/output3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/output3/bn/moving_variance:0': 'model/layer_with_weights-1/output3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge1/bn/moving_mean:0': 'model/layer_with_weights-1/merge1/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge1/bn/moving_variance:0': 'model/layer_with_weights-1/merge1/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge2/bn/moving_mean:0': 'model/layer_with_weights-1/merge2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'FPN/merge2/bn/moving_variance:0': 'model/layer_with_weights-1/merge2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_3x3/conv/kernel:0': 'model/layer_with_weights-2/conv_3x3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_3x3/bn/gamma:0': 'model/layer_with_weights-2/conv_3x3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_3x3/bn/beta:0': 'model/layer_with_weights-2/conv_3x3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_1/conv/kernel:0': 'model/layer_with_weights-2/conv_5x5_1/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_1/bn/gamma:0': 'model/layer_with_weights-2/conv_5x5_1/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_1/bn/beta:0': 'model/layer_with_weights-2/conv_5x5_1/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_2/conv/kernel:0': 'model/layer_with_weights-2/conv_5x5_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_2/bn/gamma:0': 'model/layer_with_weights-2/conv_5x5_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_2/bn/beta:0': 'model/layer_with_weights-2/conv_5x5_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_2/conv/kernel:0': 'model/layer_with_weights-2/conv_7x7_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_2/bn/gamma:0': 'model/layer_with_weights-2/conv_7x7_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_2/bn/beta:0': 'model/layer_with_weights-2/conv_7x7_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_3/conv/kernel:0': 'model/layer_with_weights-2/conv_7x7_3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_3/bn/gamma:0': 'model/layer_with_weights-2/conv_7x7_3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_3/bn/beta:0': 'model/layer_with_weights-2/conv_7x7_3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_3x3/bn/moving_mean:0': 'model/layer_with_weights-2/conv_3x3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_3x3/bn/moving_variance:0': 'model/layer_with_weights-2/conv_3x3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_1/bn/moving_mean:0': 'model/layer_with_weights-2/conv_5x5_1/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_1/bn/moving_variance:0': 'model/layer_with_weights-2/conv_5x5_1/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_2/bn/moving_mean:0': 'model/layer_with_weights-2/conv_5x5_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_5x5_2/bn/moving_variance:0': 'model/layer_with_weights-2/conv_5x5_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_2/bn/moving_mean:0': 'model/layer_with_weights-2/conv_7x7_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_2/bn/moving_variance:0': 'model/layer_with_weights-2/conv_7x7_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_3/bn/moving_mean:0': 'model/layer_with_weights-2/conv_7x7_3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_0/conv_7x7_3/bn/moving_variance:0': 'model/layer_with_weights-2/conv_7x7_3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_3x3/conv/kernel:0': 'model/layer_with_weights-3/conv_3x3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_3x3/bn/gamma:0': 'model/layer_with_weights-3/conv_3x3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_3x3/bn/beta:0': 'model/layer_with_weights-3/conv_3x3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_1/conv/kernel:0': 'model/layer_with_weights-3/conv_5x5_1/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_1/bn/gamma:0': 'model/layer_with_weights-3/conv_5x5_1/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_1/bn/beta:0': 'model/layer_with_weights-3/conv_5x5_1/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_2/conv/kernel:0': 'model/layer_with_weights-3/conv_5x5_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_2/bn/gamma:0': 'model/layer_with_weights-3/conv_5x5_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_2/bn/beta:0': 'model/layer_with_weights-3/conv_5x5_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_2/conv/kernel:0': 'model/layer_with_weights-3/conv_7x7_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_2/bn/gamma:0': 'model/layer_with_weights-3/conv_7x7_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_2/bn/beta:0': 'model/layer_with_weights-3/conv_7x7_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_3/conv/kernel:0': 'model/layer_with_weights-3/conv_7x7_3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_3/bn/gamma:0': 'model/layer_with_weights-3/conv_7x7_3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_3/bn/beta:0': 'model/layer_with_weights-3/conv_7x7_3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_3x3/bn/moving_mean:0': 'model/layer_with_weights-3/conv_3x3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_3x3/bn/moving_variance:0': 'model/layer_with_weights-3/conv_3x3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_1/bn/moving_mean:0': 'model/layer_with_weights-3/conv_5x5_1/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_1/bn/moving_variance:0': 'model/layer_with_weights-3/conv_5x5_1/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_2/bn/moving_mean:0': 'model/layer_with_weights-3/conv_5x5_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_5x5_2/bn/moving_variance:0': 'model/layer_with_weights-3/conv_5x5_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_2/bn/moving_mean:0': 'model/layer_with_weights-3/conv_7x7_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_2/bn/moving_variance:0': 'model/layer_with_weights-3/conv_7x7_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_3/bn/moving_mean:0': 'model/layer_with_weights-3/conv_7x7_3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_1/conv_7x7_3/bn/moving_variance:0': 'model/layer_with_weights-3/conv_7x7_3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_3x3/conv/kernel:0': 'model/layer_with_weights-4/conv_3x3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_3x3/bn/gamma:0': 'model/layer_with_weights-4/conv_3x3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_3x3/bn/beta:0': 'model/layer_with_weights-4/conv_3x3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_1/conv/kernel:0': 'model/layer_with_weights-4/conv_5x5_1/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_1/bn/gamma:0': 'model/layer_with_weights-4/conv_5x5_1/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_1/bn/beta:0': 'model/layer_with_weights-4/conv_5x5_1/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_2/conv/kernel:0': 'model/layer_with_weights-4/conv_5x5_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_2/bn/gamma:0': 'model/layer_with_weights-4/conv_5x5_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_2/bn/beta:0': 'model/layer_with_weights-4/conv_5x5_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_2/conv/kernel:0': 'model/layer_with_weights-4/conv_7x7_2/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_2/bn/gamma:0': 'model/layer_with_weights-4/conv_7x7_2/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_2/bn/beta:0': 'model/layer_with_weights-4/conv_7x7_2/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_3/conv/kernel:0': 'model/layer_with_weights-4/conv_7x7_3/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_3/bn/gamma:0': 'model/layer_with_weights-4/conv_7x7_3/bn/gamma/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_3/bn/beta:0': 'model/layer_with_weights-4/conv_7x7_3/bn/beta/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_3x3/bn/moving_mean:0': 'model/layer_with_weights-4/conv_3x3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_3x3/bn/moving_variance:0': 'model/layer_with_weights-4/conv_3x3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_1/bn/moving_mean:0': 'model/layer_with_weights-4/conv_5x5_1/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_1/bn/moving_variance:0': 'model/layer_with_weights-4/conv_5x5_1/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_2/bn/moving_mean:0': 'model/layer_with_weights-4/conv_5x5_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_5x5_2/bn/moving_variance:0': 'model/layer_with_weights-4/conv_5x5_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_2/bn/moving_mean:0': 'model/layer_with_weights-4/conv_7x7_2/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_2/bn/moving_variance:0': 'model/layer_with_weights-4/conv_7x7_2/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_3/bn/moving_mean:0': 'model/layer_with_weights-4/conv_7x7_3/bn/moving_mean/.ATTRIBUTES/VARIABLE_VALUE', 'SSH_2/conv_7x7_3/bn/moving_variance:0': 'model/layer_with_weights-4/conv_7x7_3/bn/moving_variance/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_0/conv/kernel:0': 'model/layer_with_weights-5/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_0/conv/bias:0': 'model/layer_with_weights-5/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_1/conv/kernel:0': 'model/layer_with_weights-6/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_1/conv/bias:0': 'model/layer_with_weights-6/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_2/conv/kernel:0': 'model/layer_with_weights-7/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'ClassHead_2/conv/bias:0': 'model/layer_with_weights-7/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_0/conv/kernel:0': 'model/layer_with_weights-8/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_0/conv/bias:0': 'model/layer_with_weights-8/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_1/conv/kernel:0': 'model/layer_with_weights-9/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_1/conv/bias:0': 'model/layer_with_weights-9/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_2/conv/kernel:0': 'model/layer_with_weights-10/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'BboxHead_2/conv/bias:0': 'model/layer_with_weights-10/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_0/conv/kernel:0': 'model/layer_with_weights-11/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_0/conv/bias:0': 'model/layer_with_weights-11/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_1/conv/kernel:0': 'model/layer_with_weights-12/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_1/conv/bias:0': 'model/layer_with_weights-12/conv/bias/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_2/conv/kernel:0': 'model/layer_with_weights-13/conv/kernel/.ATTRIBUTES/VARIABLE_VALUE', 'LandmarkHead_2/conv/bias:0': 'model/layer_with_weights-13/conv/bias/.ATTRIBUTES/VARIABLE_VALUE'}

    names = []
    for w in model.all_weights:
        name = w.name
        name = name.replace("filters:0", "kernel:0")
        name = name.replace("biases:0", "bias:0")
        name = name.replace("moving_var:0", "moving_variance:0")
        name = weight_name_dict[name]
        array = tf.train.load_variable(file_path, name)
        names.append(name)
        w.assign(array)

    return model


def _smooth_l1_loss(y_true, y_pred):
    t = tlx.abs(y_pred - y_true)
    return tlx.where(t < 1, 0.5 * t ** 2, t - 0.5)


def MultiBoxLoss(num_class=2, neg_pos_ratio=3):
    """multi-box loss"""
    def multi_box_loss(y_true, y_pred):
        num_batch = tlx.get_tensor_shape(y_true)[0]
        num_prior = tlx.get_tensor_shape(y_true)[1]

        loc_pred = tlx.reshape(y_pred[0], [num_batch * num_prior, 4])
        landm_pred = tlx.reshape(y_pred[1], [num_batch * num_prior, 10])
        class_pred = tlx.reshape(y_pred[2], [num_batch * num_prior, num_class])
        loc_true = tlx.reshape(y_true[..., :4], [num_batch * num_prior, 4])
        landm_true = tlx.reshape(y_true[..., 4:14], [num_batch * num_prior, 10])
        landm_valid = tlx.reshape(y_true[..., 14], [num_batch * num_prior, 1])
        class_true = tlx.reshape(y_true[..., 15], [num_batch * num_prior, 1])

        # define filter mask: class_true = 1 (pos), 0 (neg), -1 (ignore)
        #                     landm_valid = 1 (w landm), 0 (w/o landm)
        mask_pos = tlx.equal(class_true, 1)
        mask_neg = tlx.equal(class_true, 0)
        mask_landm = tlx.logical_and(tlx.equal(landm_valid, 1), mask_pos)

        # landm loss (smooth L1)
        mask_landm_b = tlx.tile(mask_landm, [1, tlx.get_tensor_shape(landm_true)[1]])
        loss_landm = _smooth_l1_loss(landm_true[mask_landm_b],
                                     landm_pred[mask_landm_b])
        loss_landm = tlx.reduce_mean(loss_landm)

        # localization loss (smooth L1)
        mask_pos_b = tlx.tile(mask_pos, [1, tlx.get_tensor_shape(loc_true)[1]])

        loss_loc = _smooth_l1_loss(loc_true[mask_pos_b],
                                   loc_pred[mask_pos_b])
        loss_loc = tlx.reduce_mean(loss_loc)

        # classification loss (crossentropy)
        # 1. compute max conf across batch for hard negative mining
        loss_class = tlx.where(mask_neg,
                              1 - class_pred[:, 0][..., None], 0)

        # 2. hard negative mining
        loss_class = tlx.reshape(loss_class, [num_batch, num_prior])
        loss_class_idx = tlx.argsort(loss_class, axis=1, descending=True)
        loss_class_idx_rank = tlx.argsort(loss_class_idx, axis=1)
        mask_pos_per_batch = tlx.reshape(mask_pos, [num_batch, num_prior])
        num_pos_per_batch = tlx.reduce_sum(
                tlx.cast(mask_pos_per_batch, tlx.float32), 1, keepdims=True)
        num_pos_per_batch = tlx.maximum(num_pos_per_batch, 1)
        num_neg_per_batch = tlx.minimum(neg_pos_ratio * num_pos_per_batch,
                                       tlx.cast(num_prior, tlx.float32) - 1)
        mask_hard_neg = tlx.reshape(
            tlx.cast(loss_class_idx_rank, tlx.float32) < num_neg_per_batch,
            [num_batch * num_prior, 1])

        # 3. classification loss including positive and negative examples
        loss_class_mask = tlx.logical_or(mask_pos, mask_hard_neg)
        loss_class_mask_b = tlx.tile(loss_class_mask, [1, tlx.get_tensor_shape(class_pred)[1]])
        filter_class_true = tlx.cast(mask_pos, tlx.int32)[loss_class_mask]
        filter_class_pred = class_pred[loss_class_mask_b]
        filter_class_pred = tlx.reshape(filter_class_pred, [-1, num_class])

        loss_class = tlx.losses.softmax_cross_entropy_with_logits(output=filter_class_pred,
                                                                  target=filter_class_true, reduction="mean")

        return loss_loc, loss_landm, loss_class

    return multi_box_loss